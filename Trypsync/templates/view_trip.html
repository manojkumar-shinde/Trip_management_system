{% extends 'base.html' %}

{% block title %}{{ trip.title }} - TripSync{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-start">
  <div>
    <h2>{{ trip.title }}</h2>
    <p class="text-muted">{{ trip.destination }} — {{ trip.start_date }} to {{ trip.end_date }}</p>
  </div>
  <div>
    <a class="btn btn-outline-primary me-2" href="{{ url_for('edit_trip', trip_id=trip.id) }}">Edit</a>
    <a class="btn btn-secondary" href="{{ url_for('dashboard') }}">Back</a>
  </div>
</div>

<div class="mt-3">
  <h5>Description</h5>
  <p>{{ trip.description or 'No description' }}</p>
</div>

<div class="mt-4 d-flex justify-content-between align-items-center">
  <h4>Itinerary</h4>
  <div>
    <a class="btn btn-sm btn-outline-primary me-2" href="{{ url_for('trip_expenses', trip_id=trip.id) }}">Expenses</a>
    <a class="btn btn-sm btn-primary" href="{{ url_for('create_itinerary', trip_id=trip.id) }}">Add item</a>
  </div>
</div>

{% if itinerary_dates %}
  <div class="accordion mt-2" id="itineraryAccordion">
    {% for d in itinerary_dates %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ loop.index }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
            {{ d }}
          </button>
        </h2>
        <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" aria-labelledby="heading{{ loop.index }}" data-bs-parent="#itineraryAccordion">
          <div class="accordion-body">
            <ul class="list-group">
            {% for it in grouped_itinerary[d] %}
              <li class="list-group-item d-flex justify-content-between align-items-start">
                <div>
                  <strong>{{ it.title }}</strong>
                  <div class="text-muted small">{{ it.datetime.time() }} — {{ it.location or '' }} {% if it.cost %} • ${{ it.cost }}{% endif %}</div>
                  <div>{{ it.description or '' }}</div>
                </div>
                <div class="btn-group btn-group-sm">
                  <a class="btn btn-outline-secondary" href="{{ url_for('edit_itinerary', item_id=it.id) }}">Edit</a>
                  <form method="post" action="{{ url_for('delete_itinerary', item_id=it.id) }}" onsubmit="return confirm('Delete this item?');">
                    <button class="btn btn-outline-danger">Delete</button>
                  </form>
                </div>
              </li>
            {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="mt-2"><em>No itinerary items yet.</em></p>
{% endif %}

{% endblock %}
