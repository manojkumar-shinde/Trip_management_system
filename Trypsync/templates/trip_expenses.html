{% extends 'base.html' %}

{% block title %}Expenses - {{ trip.title }} - TripSync{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h3>Expenses — {{ trip.title }}</h3>
  <div>
    <a class="btn btn-primary" href="{{ url_for('create_expense', trip_id=trip.id) }}">Add Expense</a>
    <a class="btn btn-secondary" href="{{ url_for('view_trip', trip_id=trip.id) }}">Back to Trip</a>
  </div>
</div>

<div class="mt-3">
  <h5>Balances</h5>
  {% if balances %}
    <ul class="list-group">
      {% for b in balances %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>{{ b.name }}</div>
          <div>
            {% if b.balance > 0 %}
              <span class="text-success">${{ '%.2f'|format(b.balance) }} owed to them</span>
            {% elif b.balance < 0 %}
              <span class="text-danger">${{ '%.2f'|format(-b.balance) }} owes</span>
            {% else %}
              <span class="text-muted">Settled</span>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted"><em>No balances yet.</em></p>
  {% endif %}
</div>

<div class="mt-4">
  <h5>Settle-ups</h5>
  {% if settlements %}
    <ul class="list-group">
      {% for s in settlements %}
        <li class="list-group-item">{{ s.from_name }} pays {{ s.to_name }} <strong>${{ '%.2f'|format(s.amount) }}</strong></li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted"><em>No settlements needed.</em></p>
  {% endif %}
</div>

<div class="mt-4">
  <h5>Expenses</h5>
  {% if expenses %}
    <ul class="list-group">
      {% for e in expenses %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ e.title }}</strong> — ${{ '%.2f'|format(e.amount) }}
              <div class="text-muted small">Paid by {{ e.payer }} • Participants: {{ e.participants|join(', ') }}</div>
              {% if e.notes %}
                <div class="mt-1">{{ e.notes }}</div>
              {% endif %}
            </div>
            <div class="btn-group btn-group-sm">
              <a class="btn btn-outline-secondary" href="{{ url_for('edit_expense', expense_id=e.id) }}">Edit</a>
              <form method="post" action="{{ url_for('delete_expense', expense_id=e.id) }}" onsubmit="return confirm('Delete this expense?');">
                <button class="btn btn-outline-danger">Delete</button>
              </form>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted"><em>No expenses yet.</em></p>
  {% endif %}
</div>

{% endblock %}
